# Task Scheduler

## Описание проблемы

Запускаем асинхронные задачи с частотой 1–3000 задач/сек, частоту можно менять в реальном времени, при этом стараемся минимизировать погрешности таймеров.

## Использованные методы

В проекте реализовано подход "пакетирования":

1. **Метод Пакетирования (Batching)**

   * Задачи собираются в «пакеты» размером `batchSize`, рассчитываемым на основании требуемой RPS и минимальной задержки таймера (\~4 мс).
   * Внутри `setInterval(minInterval)` каждый тик запускает сразу `batchSize` задач — это позволяет выдержать высокую частоту при небольших погрешностях.

Но стоит отметить второй возможный оптимальный путь к решению:

2. **Метод Таймера с Компенсацией Опозданий (Drift Compensation)**

   * Используется частый таймер (`setTimeout`) и переменная `nextTime`, хранящая время, к которому должна была быть запущена следующая задача.
   * В каждом тике считается реальный «дрейф» (`drift = now - nextTime`), и следующее срабатывание назначается с учётом накопленной задержки: `setTimeout(tick, Math.max(0, period - drift))`.
   * Такой подход обеспечивает более ровный поток одиночных запусков без пакетов.

## Установка и запуск

1. Установите зависимости:

   ```bash
   npm install
   ```

2. Запустите программу:

   ```bash
   npm run start
   ```

## Настройка частоты

Входное значение RPS задаётся в конструкторе класса `BatchingScheduler`. Пример:

```typescript
const scheduler = new DynamicScheduler(runTask, 100); // 100 задач в секунду
scheduler.setRate(500); // изменить частоту на 500 RPS в реальном времени
```
